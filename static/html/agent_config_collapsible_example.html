<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯æŠ˜å é…ç½®åŒºåŸŸç¤ºä¾‹</title>
    <link rel="stylesheet" href="/static/css/agent_management.css">
    <style>
        body {
            padding: 40px;
            max-width: 1200px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ¨ Agent é…ç½®åŒºåŸŸ - å¯æŠ˜å ç¤ºä¾‹</h1>
    <p style="color: #666; margin-bottom: 30px;">
        è¿™æ˜¯4ä¸ªä¸»è¦é…ç½®åŒºåŸŸçš„å¯æŠ˜å ç‰ˆæœ¬ï¼ŒåŒ…å«è¯¦ç»†è¯´æ˜å’Œå­—æ®µå…³è”å…³ç³»ã€‚
    </p>

    <!-- ============================================
         1. Prompt Configuration Section
         ============================================ -->
    <div class="config-section">
        <div class="config-header" onclick="toggleConfigSection(this)">
            <div class="config-header-left">
                <div class="config-icon">ğŸ’¬</div>
                <div class="config-title-group">
                    <h3 class="config-title">Prompt Configuration</h3>
                    <p class="config-subtitle">AI conversation prompts and instructions</p>
                </div>
            </div>
            <div>
                <span class="config-badge">
                    <span>ğŸ”‘</span>
                    <span>Core</span>
                </span>
                <span class="config-toggle">â–¼</span>
            </div>
        </div>
        
        <div class="config-body">
            <!-- Help Box -->
            <div class="config-help-box">
                <div class="config-help-title">
                    <span>ğŸ“š</span>
                    <span>é…ç½®è¯´æ˜</span>
                </div>
                <div class="config-help-content">
                    <p><strong>Prompt Configuration</strong> æ§åˆ¶ AI å¦‚ä½•ä¸ç”¨æˆ·å¯¹è¯ã€‚åŒ…å«ä»¥ä¸‹å…³é”®å­—æ®µï¼š</p>
                    <ul>
                        <li><code>greeting_template</code> - åˆå§‹é—®å€™è¯­ï¼Œç”¨æˆ·æ¥é€šç”µè¯æ—¶çš„ç¬¬ä¸€å¥è¯</li>
                        <li><code>realtime_template</code> - å®æ—¶å¯¹è¯æŒ‡ä»¤ï¼Œæ§åˆ¶æ•´ä¸ªé€šè¯è¿‡ç¨‹ä¸­çš„ AI è¡Œä¸º</li>
                        <li><code>system_instructions</code> - ç³»ç»Ÿçº§æŒ‡ä»¤ï¼Œå®šä¹‰ AI çš„è§’è‰²å’Œè¡Œä¸ºå‡†åˆ™</li>
                        <li><code>conversation_flow</code> - å¯¹è¯æµç¨‹æ­¥éª¤ï¼ŒæŒ‡å¯¼ AI æŒ‰é¡ºåºå¼•å¯¼å¯¹è¯</li>
                        <li><code>example_dialogues</code> - ç¤ºä¾‹å¯¹è¯ï¼Œå¸®åŠ© AI å­¦ä¹ æœŸæœ›çš„å¯¹è¯é£æ ¼</li>
                        <li><code>language_instructions</code> - å¤šè¯­è¨€æŒ‡ä»¤ï¼Œé’ˆå¯¹ä¸åŒè¯­è¨€çš„ç‰¹æ®Šè¦æ±‚</li>
                    </ul>
                </div>
            </div>

            <!-- Field Relationship -->
            <div class="field-relationship">
                <div class="field-relationship-title">
                    <span>ğŸ”—</span>
                    <span>å­—æ®µå…³è”å…³ç³»</span>
                </div>
                <p><strong>greeting_template</strong> â†’ ä»…åœ¨é€šè¯å¼€å§‹æ—¶ä½¿ç”¨ä¸€æ¬¡</p>
                <p><strong>realtime_template</strong> â†’ æ•´ä¸ªé€šè¯è¿‡ç¨‹æŒç»­ç”Ÿæ•ˆï¼ˆæœ€é‡è¦ï¼‰</p>
                <p><strong>system_instructions</strong> â†’ ä¸ realtime_template é…åˆï¼Œæä¾›é¢å¤–çš„ç³»ç»Ÿçº§çº¦æŸ</p>
                <p><strong>conversation_flow</strong> â†’ åº”è¯¥åœ¨ realtime_template ä¸­å¼•ç”¨è¿™äº›æ­¥éª¤</p>
            </div>

            <!-- Example -->
            <div class="example-box">
                <div class="example-box-title">ğŸ’¡ å®Œæ•´ç¤ºä¾‹</div>
                <pre>{
  "greeting_template": "ä½ å¥½ï¼æˆ‘æ˜¯å°åŠ©æ‰‹ï¼Œå¾ˆé«˜å…´ä¸ºæ‚¨æœåŠ¡ï¼",
  "realtime_template": "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å®¢æœåŠ©æ‰‹ã€‚\nè¯·éµå¾ªä»¥ä¸‹å¯¹è¯æµç¨‹ï¼š\n1. é—®å€™å®¢æˆ·\n2. äº†è§£éœ€æ±‚\n3. æä¾›è§£å†³æ–¹æ¡ˆ\n4. ç¡®è®¤æ»¡æ„åº¦",
  "system_instructions": "ä¿æŒç¤¼è²Œã€ä¸“ä¸šã€é«˜æ•ˆ",
  "conversation_flow": ["greet", "identify_need", "provide_solution", "confirm"],
  "example_dialogues": {
    "en": "User: I need help\\nAgent: I'm here to assist you!",
    "zh": "ç”¨æˆ·: æˆ‘éœ€è¦å¸®åŠ©\\nå®¢æœ: æˆ‘åœ¨è¿™é‡Œå¸®åŠ©æ‚¨ï¼"
  },
  "language_instructions": {
    "en": "Speak in clear, professional English",
    "zh": "ä½¿ç”¨æ ‡å‡†æ™®é€šè¯ï¼Œè¯­æ°”äº²åˆ‡"
  }
}</pre>
            </div>

            <!-- Form Fields -->
            <h4>ğŸ“ é…ç½®å­—æ®µ</h4>
            <div class="form-group">
                <label for="greetingTemplate">Greeting Template</label>
                <textarea id="greetingTemplate" rows="4" 
                          placeholder="Enter greeting template..."></textarea>
                <small class="form-help">åˆæ¬¡é—®å€™è¯­ï¼Œåªåœ¨é€šè¯å¼€å§‹æ—¶è¯´ä¸€æ¬¡</small>
            </div>
            
            <div class="form-group">
                <label for="realtimeTemplate">Realtime Template *</label>
                <textarea id="realtimeTemplate" rows="6" 
                          placeholder="Enter realtime conversation template..."></textarea>
                <small class="form-help">â­ æœ€é‡è¦ï¼šå®šä¹‰æ•´ä¸ªé€šè¯è¿‡ç¨‹ä¸­ AI çš„è¡Œä¸ºå’ŒæŒ‡ä»¤</small>
            </div>
        </div>
    </div>

    <!-- ============================================
         2. RAG Configuration Section
         ============================================ -->
    <div class="config-section collapsed">
        <div class="config-header" onclick="toggleConfigSection(this)">
            <div class="config-header-left">
                <div class="config-icon">ğŸ”—</div>
                <div class="config-title-group">
                    <h3 class="config-title">RAG Configuration</h3>
                    <p class="config-subtitle">Retrieval-Augmented Generation settings</p>
                </div>
            </div>
            <div>
                <span class="config-badge">
                    <span>ğŸ“Š</span>
                    <span>Optional</span>
                </span>
                <span class="config-toggle">â–¼</span>
            </div>
        </div>
        
        <div class="config-body">
            <div class="config-help-box">
                <div class="config-help-title">
                    <span>ğŸ“š</span>
                    <span>é…ç½®è¯´æ˜</span>
                </div>
                <div class="config-help-content">
                    <p><strong>RAG (Retrieval-Augmented Generation)</strong> è®© AI ä»çŸ¥è¯†åº“ä¸­æ£€ç´¢ä¿¡æ¯æ¥å›ç­”é—®é¢˜ã€‚</p>
                    <ul>
                        <li><code>enabled</code> - æ˜¯å¦å¯ç”¨ RAG åŠŸèƒ½</li>
                        <li><code>base_url</code> - RAG API ç«¯ç‚¹åœ°å€</li>
                        <li><code>token</code> - API è®¤è¯ä»¤ç‰Œ</li>
                        <li><code>workflow_id</code> - Dify workflow ID</li>
                        <li><code>description</code> - RAG çŸ¥è¯†åº“çš„æè¿°ï¼ˆAI ä¼šæ ¹æ®æ­¤åˆ¤æ–­ä½•æ—¶è°ƒç”¨ï¼‰</li>
                    </ul>
                </div>
            </div>

            <div class="field-relationship">
                <div class="field-relationship-title">
                    <span>ğŸ”—</span>
                    <span>ä½¿ç”¨åœºæ™¯</span>
                </div>
                <p><strong>å½“ç”¨æˆ·æé—®æ—¶</strong> â†’ AI åˆ¤æ–­æ˜¯å¦éœ€è¦æŸ¥è¯¢çŸ¥è¯†åº“ â†’ è°ƒç”¨ RAG API â†’ è·å–ç›¸å…³ä¿¡æ¯ â†’ åŸºäºæ£€ç´¢ç»“æœå›ç­”</p>
                <p><strong>description å­—æ®µå¾ˆé‡è¦</strong>ï¼šAI æ ¹æ®è¿™ä¸ªæè¿°å†³å®šä½•æ—¶è°ƒç”¨ RAG</p>
            </div>

            <div class="example-box">
                <div class="example-box-title">ğŸ’¡ å®Œæ•´ç¤ºä¾‹</div>
                <pre>{
  "enabled": true,
  "base_url": "https://api.dify.ai/v1",
  "token": "app-xxxxxxxxxxxxx",
  "workflow_id": "workflow-123",
  "description": "å…¬å¸äº§å“æ‰‹å†Œå’ŒFAQçŸ¥è¯†åº“ï¼ŒåŒ…å«äº§å“åŠŸèƒ½ã€ä»·æ ¼ã€ä½¿ç”¨æ–¹æ³•ç­‰ä¿¡æ¯",
  "timeout": 30,
  "max_retries": 3
}</pre>
            </div>
        </div>
    </div>

    <!-- ============================================
         3. API Configuration Section
         ============================================ -->
    <div class="config-section collapsed">
        <div class="config-header" onclick="toggleConfigSection(this)">
            <div class="config-header-left">
                <div class="config-icon">ğŸ”Œ</div>
                <div class="config-title-group">
                    <h3 class="config-title">API Configuration</h3>
                    <p class="config-subtitle">External API endpoints and integrations</p>
                </div>
            </div>
            <div>
                <span class="config-badge">
                    <span>ğŸ”§</span>
                    <span>Optional</span>
                </span>
                <span class="config-toggle">â–¼</span>
            </div>
        </div>
        
        <div class="config-body">
            <div class="config-help-box">
                <div class="config-help-title">
                    <span>ğŸ“š</span>
                    <span>é…ç½®è¯´æ˜</span>
                </div>
                <div class="config-help-content">
                    <p><strong>API Configuration</strong> å®šä¹‰ AI å¯ä»¥è°ƒç”¨çš„å¤–éƒ¨ API æ¥å£ã€‚</p>
                    <ul>
                        <li><code>endpoints</code> - API ç«¯ç‚¹æ˜ å°„ï¼Œæ ¼å¼ï¼š{"function_name": "api_url"}</li>
                        <li><code>tokens</code> - API è®¤è¯ä»¤ç‰Œï¼Œæ ¼å¼ï¼š{"function_name": "token"}</li>
                        <li><code>headers</code> - é€šç”¨ HTTP è¯·æ±‚å¤´</li>
                    </ul>
                </div>
            </div>

            <div class="field-relationship">
                <div class="field-relationship-title">
                    <span>ğŸ”—</span>
                    <span>ä¸ Business Rules çš„å…³è”</span>
                </div>
                <p><strong>é‡è¦å…³è”</strong>ï¼šå¦‚æœ <code>function_call_rules</code> ä¸­å®šä¹‰çš„å‡½æ•°ååœ¨ <code>endpoints</code> ä¸­æœ‰å¯¹åº”çš„ URL</p>
                <p>â†’ AI ä¼šè°ƒç”¨è¯¥ API URLï¼ˆè€Œä¸æ˜¯å‘é€ WhatsApp æ¨¡æ¿ï¼‰</p>
                <p>â†’ å¦‚æœæ²¡æœ‰å¯¹åº”çš„ URLï¼Œåˆ™ä½¿ç”¨é»˜è®¤çš„ WhatsApp æ¨¡æ¿å‘é€é€»è¾‘</p>
                <br>
                <p><strong>ä¼˜å…ˆçº§</strong>ï¼šAPI Config > é»˜è®¤ WhatsApp å·¥å…·</p>
            </div>

            <div class="example-box">
                <div class="example-box-title">ğŸ’¡ å®Œæ•´ç¤ºä¾‹</div>
                <pre>{
  "endpoints": {
    "get_order_status": "https://api.example.com/orders/{order_id}",
    "create_ticket": "https://api.example.com/tickets"
  },
  "tokens": {
    "get_order_status": "bearer-token-xxx",
    "create_ticket": "bearer-token-yyy"
  },
  "headers": {
    "Content-Type": "application/json",
    "Accept": "application/json"
  }
}</pre>
            </div>
        </div>
    </div>

    <!-- ============================================
         4. Business Rules Section
         ============================================ -->
    <div class="config-section">
        <div class="config-header" onclick="toggleConfigSection(this)">
            <div class="config-header-left">
                <div class="config-icon">ğŸ“‹</div>
                <div class="config-title-group">
                    <h3 class="config-title">Business Rules</h3>
                    <p class="config-subtitle">Tool permissions and business logic</p>
                </div>
            </div>
            <div>
                <span class="config-badge">
                    <span>ğŸ”‘</span>
                    <span>Core</span>
                </span>
                <span class="config-toggle">â–¼</span>
            </div>
        </div>
        
        <div class="config-body">
            <div class="config-help-box">
                <div class="config-help-title">
                    <span>ğŸ“š</span>
                    <span>é…ç½®è¯´æ˜</span>
                </div>
                <div class="config-help-content">
                    <p><strong>Business Rules</strong> æ§åˆ¶ AI å¯ä»¥ä½¿ç”¨å“ªäº›å·¥å…·å’Œæ‰§è¡Œå“ªäº›æ“ä½œã€‚</p>
                    <ul>
                        <li><code>allowed_actions</code> - å…è®¸çš„æ“ä½œ/å·¥å…·åˆ—è¡¨ï¼ˆç™½åå•æ¨¡å¼ï¼‰</li>
                        <li><code>function_call_rules</code> - æ¯ä¸ªå·¥å…·çš„è¯¦ç»†å®šä¹‰ï¼ˆæè¿°ã€è§¦å‘æ¡ä»¶ã€å‚æ•°ï¼‰</li>
                        <li><code>working_hours</code> - å·¥ä½œæ—¶é—´è®¾ç½®</li>
                        <li><code>max_conversation_time</code> - æœ€å¤§é€šè¯æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰</li>
                    </ul>
                </div>
            </div>

            <div class="field-relationship">
                <div class="field-relationship-title">
                    <span>ğŸ”—</span>
                    <span>é‡è¦å…³è”å…³ç³»</span>
                </div>
                <p><strong>1. allowed_actions â†” function_call_rules</strong></p>
                <p style="margin-left: 20px;">
                    â€¢ <code>allowed_actions</code> æ˜¯ç®€å•çš„å·¥å…·åç§°åˆ—è¡¨ï¼ˆç™½åå•ï¼‰<br>
                    â€¢ <code>function_call_rules</code> æä¾›æ¯ä¸ªå·¥å…·çš„è¯¦ç»†å®šä¹‰<br>
                    â€¢ AI åªèƒ½ä½¿ç”¨åœ¨ <code>allowed_actions</code> ä¸­åˆ—å‡ºçš„å·¥å…·<br>
                    â€¢ å¦‚æœå·¥å…·åœ¨ <code>function_call_rules</code> ä¸­æœ‰å®šä¹‰ï¼Œä½¿ç”¨è‡ªå®šä¹‰å®šä¹‰ï¼›å¦åˆ™ä½¿ç”¨ç³»ç»Ÿé»˜è®¤å®šä¹‰
                </p>
                <br>
                <p><strong>2. function_call_rules â†” API Config</strong></p>
                <p style="margin-left: 20px;">
                    â€¢ å¦‚æœ <code>API Config.endpoints</code> ä¸­æœ‰åŒåç«¯ç‚¹ â†’ è°ƒç”¨ API<br>
                    â€¢ å¦‚æœæ²¡æœ‰ â†’ ä½¿ç”¨é»˜è®¤çš„ WhatsApp å·¥å…·æ‰§è¡Œå™¨
                </p>
            </div>

            <div class="example-box">
                <div class="example-box-title">ğŸ’¡ å®Œæ•´ç¤ºä¾‹</div>
                <pre>{
  "allowed_actions": [
    "book_appointment",
    "send_whatsapp_message"
  ],
  "required_fields": [],
  "max_conversation_time": 30,
  "working_hours": {
    "timezone": "Asia/Singapore",
    "schedule": {
      "monday": "09:00-18:00",
      "tuesday": "09:00-18:00",
      "wednesday": "09:00-18:00",
      "thursday": "09:00-18:00",
      "friday": "09:00-18:00"
    }
  },
  "function_call_rules": {
    "book_appointment": {
      "description": "å¸®åŠ©ç”¨æˆ·é¢„çº¦ä¼šè®®æˆ–æœåŠ¡",
      "when": "ç”¨æˆ·æƒ³è¦é¢„çº¦æˆ–å®‰æ’æ—¶é—´",
      "parameters": {
        "type": "object",
        "properties": {
          "whatsappNumber": {
            "type": "string",
            "description": "ç”¨æˆ·WhatsAppå·ç "
          },
          "meetingTime": {
            "type": "string",
            "description": "ä¼šè®®æ—¶é—´ (ISO 8601æ ¼å¼)"
          }
        },
        "required": ["whatsappNumber", "meetingTime"]
      }
    }
  }
}</pre>
            </div>

            <!-- Form Fields -->
            <h4>ğŸ“ é…ç½®å­—æ®µ</h4>
            <div class="form-group">
                <label for="allowedActions">Allowed Actions (comma-separated)</label>
                <input type="text" id="allowedActions" 
                       value="book_appointment, send_whatsapp_message"
                       placeholder="book_appointment, send_whatsapp_message">
                <small class="form-help">âš¡ å·¥å…·ç™½åå•ï¼šåªæœ‰è¿™é‡Œåˆ—å‡ºçš„å·¥å…· AI æ‰èƒ½ä½¿ç”¨</small>
            </div>
            
            <div class="form-group">
                <label for="functionCallRules">Function Call Rules (JSON format)</label>
                <textarea id="functionCallRules" rows="12" 
                          style="font-family: monospace; font-size: 13px;">{
  "book_appointment": {
    "description": "Send a WhatsApp booking template for general appointment",
    "when": "user wants to schedule a meeting",
    "parameters": {
      "type": "object",
      "properties": {
        "whatsappNumber": {"type": "string"},
        "meetingTime": {"type": "string"}
      },
      "required": ["whatsappNumber", "meetingTime"]
    }
  }
}</textarea>
                <small class="form-help">âš™ï¸ è¯¦ç»†å®šä¹‰æ¯ä¸ªå·¥å…·çš„è¡Œä¸ºå’Œå‚æ•°</small>
            </div>
        </div>
    </div>

    <script>
        function toggleConfigSection(header) {
            const section = header.closest('.config-section');
            section.classList.toggle('collapsed');
        }

        // é»˜è®¤å±•å¼€å‰2ä¸ª
        document.addEventListener('DOMContentLoaded', function() {
            console.log('âœ… Collapsible config sections loaded');
        });
    </script>
</body>
</html>

